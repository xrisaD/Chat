(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{159:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),s=a(83),r=a.n(s),o=(a(94),a(15)),i=a.n(o),l=a(22),u=a(8),d=(a(96),a(31)),j=a(6),h=a(25),b=a(4),m=a(20),p=a.n(m),O=a(1),f=function(){var e=Object(j.g)(),t=Object(n.useState)(""),a=Object(u.a)(t,2),c=a[0],s=a[1],r=Object(n.useState)(""),o=Object(u.a)(r,2),d=o[0],m=o[1],f=Object(n.useState)(!1),x=Object(u.a)(f,2),g=x[0],v=x[1];function y(){return(y=Object(l.a)(i.a.mark((function t(a){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a.preventDefault(),n={username:c,password:d},p.a.post("https://chat.localhost/auth/login",n).then((function(t){localStorage.setItem("isAuthenticated",!0),localStorage.setItem("authorization",t.data.token),e("/chat/dashboard")})).catch((function(e){localStorage.setItem("isAuthenticated",!1),e.response&&401===e.response.status?v(!0):alert("Something went wrong. Try again later")}));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(O.jsxs)(b.a,{onSubmit:function(e){return y.apply(this,arguments)},children:[Object(O.jsxs)(b.a.Group,{className:"mb-3",controlId:"formBasicEmail",children:[Object(O.jsx)(b.a.Label,{children:"Username:"}),Object(O.jsx)(b.a.Control,{size:"lg",type:"username",placeholder:"Enter usename",value:c,onChange:function(e){return s(e.target.value)}})]}),Object(O.jsxs)(b.a.Group,{className:"mb-3",controlId:"formBasicPassword",children:[Object(O.jsx)(b.a.Label,{children:"Password:"}),Object(O.jsx)(b.a.Control,{size:"lg",type:"password",placeholder:"Password",value:d,onChange:function(e){return m(e.target.value)}}),g&&Object(O.jsx)(b.a.Text,{className:"text-muted",children:"  Wrong username or password "})]}),Object(O.jsx)(h.a,{variant:"primary",type:"submit",children:"Login"})]})},x=a(23),g=a(12),v=function(){var e=Object(j.g)(),t=Object(n.useState)(null),a=Object(u.a)(t,2),c=a[0],s=a[1];function r(){return o.apply(this,arguments)}function o(){return(o=Object(l.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e("/chat/login");case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function d(){return b.apply(this,arguments)}function b(){return(b=Object(l.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e("/chat/signup");case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function m(){return p.apply(this,arguments)}function p(){return(p=Object(l.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e("/chat/dashboard");case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}Object(n.useEffect)((function(){s(localStorage.getItem("isAuthenticated"))}),[c]);return Object(O.jsx)(x.a,{className:"mb-3",children:function(e){return null===e||"false"===e||!1===e?Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(g.a,{children:Object(O.jsx)(h.a,{onClick:d,children:"Sign Up"})}),Object(O.jsx)(g.a,{children:Object(O.jsx)(h.a,{onClick:r,children:"Log In"})})]}):"true"===e||!0===e?Object(O.jsx)(g.a,{children:Object(O.jsx)(h.a,{onClick:m,children:"Dashboard"})}):void 0}(c)})},y=function(){return Object(O.jsxs)("div",{children:[Object(O.jsx)("h1",{children:"Welcome"}),v()]})},C=a(88),S=a(28),w=function(){var e=Object(j.g)(),t=Object(n.useState)(!1),a=Object(u.a)(t,2),c=a[0],s=a[1],r=Object(n.useState)(""),o=Object(u.a)(r,2),d=o[0],m=o[1],f=Object(n.useState)(""),v=Object(u.a)(f,2),y=v[0],w=v[1],k=Object(n.useState)(""),N=Object(u.a)(k,2),I=N[0],R=N[1],F=Object(n.useState)(""),T=Object(u.a)(F,2),L=T[0],P=T[1],E=Object(n.useState)(""),G=Object(u.a)(E,2),M=G[0],z=G[1],q=Object(n.useState)(""),A=Object(u.a)(q,2),B=A[0],D=A[1],U=Object(n.useState)(""),J=Object(u.a)(U,2),V=J[0],W=J[1],Z=Object(n.useState)({}),_=Object(u.a)(Z,2),Y=_[0],H=_[1];function K(){return(K=Object(l.a)(i.a.mark((function t(a){var n,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a.preventDefault(),n={},!1===a.currentTarget.checkValidity()?(a.stopPropagation(),s(!1)):(c={username:I,password:V,firstname:d,lastname:y,email:L,city:M,zipCode:B},p.a.post("https://chat.localhost/auth/signup",c).then((function(t){localStorage.setItem("isAuthenticated",!0),localStorage.setItem("authorization",t.data.token),e("/chat/dashboard")})).catch((function(e){e.response&&412===e.response.status?(n.username="This username exists select a different username",H(n)):alert("Somethign went worng. Try again later."),s(!1)})));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(O.jsx)(S.a,{children:Object(O.jsxs)(b.a,{noValidate:!0,validated:c,onSubmit:function(e){return K.apply(this,arguments)},children:[Object(O.jsxs)(x.a,{className:"mb-3",children:[Object(O.jsxs)(b.a.Group,{as:g.a,md:"4",controlId:"validationCustom01",children:[Object(O.jsx)(b.a.Label,{children:"First name :"}),Object(O.jsx)(b.a.Control,{required:!0,type:"text",placeholder:"First name",value:d,onChange:function(e){return m(e.target.value)}}),Object(O.jsx)(b.a.Control.Feedback,{type:"invalid",children:"Please enter your first name"})]}),Object(O.jsxs)(b.a.Group,{as:g.a,md:"4",controlId:"validationCustom02",children:[Object(O.jsx)(b.a.Label,{children:"Last name :"}),Object(O.jsx)(b.a.Control,{required:!0,type:"text",placeholder:"Last name",value:y,onChange:function(e){return w(e.target.value)}}),Object(O.jsx)(b.a.Control.Feedback,{type:"invalid",children:"Please enter your last name"})]}),Object(O.jsxs)(b.a.Group,{as:g.a,md:"4",controlId:"validationCustomUsername",children:[Object(O.jsx)(b.a.Label,{children:"Username :"}),Object(O.jsxs)(C.a,{hasValidation:!0,children:[Object(O.jsx)(b.a.Control,{type:"text",placeholder:"Username","aria-describedby":"inputGroupPrepend",required:!0,isInvalid:!!Y.username,value:I,onChange:function(e){return R(e.target.value)}}),Object(O.jsx)(b.a.Control.Feedback,{type:"invalid",children:Y.username})]})]})]}),Object(O.jsxs)(x.a,{className:"mb-3",children:[Object(O.jsxs)(b.a.Group,{as:g.a,md:"4",controlId:"formBasicEmail",children:[Object(O.jsx)(b.a.Label,{children:"Email :"}),Object(O.jsx)(b.a.Control,{required:!0,type:"email",placeholder:"Enter email",value:L,onChange:function(e){return P(e.target.value)}}),Object(O.jsx)(b.a.Control.Feedback,{type:"invalid",children:"Please enter a valid email."})]}),Object(O.jsxs)(b.a.Group,{as:g.a,md:"5",controlId:"validationCustom03",children:[Object(O.jsx)(b.a.Label,{children:"City :"}),Object(O.jsx)(b.a.Control,{type:"text",placeholder:"City",required:!0,value:M,onChange:function(e){return z(e.target.value)}}),Object(O.jsx)(b.a.Control.Feedback,{type:"invalid",children:"Please provide a valid city."})]}),Object(O.jsxs)(b.a.Group,{as:g.a,md:"3",controlId:"validationCustom05",children:[Object(O.jsx)(b.a.Label,{children:"Zip Code :"}),Object(O.jsx)(b.a.Control,{type:"text",placeholder:"Zip",required:!0,value:B,onChange:function(e){return D(e.target.value)}}),Object(O.jsx)(b.a.Control.Feedback,{type:"invalid",children:"Please provide a valid zip."})]})]}),Object(O.jsx)(x.a,{className:"mb-1",children:Object(O.jsxs)(b.a.Group,{as:g.a,md:"5",controlId:"formBasicPassword",children:[Object(O.jsx)(b.a.Label,{children:"Password :"}),Object(O.jsx)(b.a.Control,{type:"password",placeholder:"Password",required:!0,value:V,onChange:function(e){return W(e.target.value)}}),Object(O.jsx)(b.a.Control.Feedback,{type:"invalid",children:"Please enter your password."})]})}),Object(O.jsx)(b.a.Group,{className:"mb-3",children:Object(O.jsx)(b.a.Check,{required:!0,label:"Agree to terms and conditions",feedback:"You must agree before submitting.",feedbackType:"invalid"})}),Object(O.jsx)(h.a,{type:"submit",children:"Submit form"})]})})},k=a(20);function N(){var e=localStorage.getItem("authorization");k.interceptors.request.use((function(t){return e&&(t.headers.authorization="Bearer "+e),t}),(function(e){return Promise.reject(e)}))}var I=a(13),R=a(2),F=a(43),T=a(44),L=a(46),P=a(45),E=(a(65),a(86)),G=a.n(E),M=a(84),z=a.n(M),q=function(e){Object(L.a)(a,e);var t=Object(P.a)(a);function a(e){var n;return Object(F.a)(this,a),(n=t.call(this,e)).handleMessageChange=function(e){n.setState({content:e.target.value})},n.handleFileChange=function(e){n.setState({file:e.target.files[0]})},n.sendMessage=function(e){e.preventDefault(),n.props.parentCallback(n.state.content,n.state.roomId,n.state.file)},n.downloadTxtFile=function(e){var t=document.createElement("a"),a=new Blob([e.content],{type:e.contentType});t.href=URL.createObjectURL(a),t.download=e.name,document.body.appendChild(t),t.click()},n.state={username:e.username,roomId:e.id,content:"",file:null,selectedRoomName:e.selectedRoomName,messages:e.messages},n}return Object(T.a)(a,[{key:"addFile",value:function(e){var t=this;if(null!==e)return Object(O.jsx)(z.a,{onClick:function(){return t.downloadTxtFile(e)},children:"Download"})}},{key:"render",value:function(){var e=this;return Object(O.jsxs)("div",{className:"chat-container",children:[Object(O.jsx)("h4",{children:this.state.selectedRoomName}),Object(O.jsx)("div",{className:"messages-container",children:this.state.messages.map((function(t,a){return t.username!==e.state.username?Object(O.jsxs)("div",{className:"message-container",children:[Object(O.jsx)(S.a,{children:Object(O.jsxs)(x.a,{className:"justify-content-md-center",children:[Object(O.jsx)(g.a,{children:Object(O.jsxs)("p",{children:[" ",t.username]})}),Object(O.jsxs)(g.a,{md:"auto",children:[Object(O.jsx)("p",{children:t.content})," "]}),Object(O.jsx)(g.a,{children:e.addFile(t.file)})]})}),Object(O.jsx)("span",{className:"time-left",children:t.time})]},a):Object(O.jsxs)("div",{className:"message-container darker",children:[Object(O.jsx)(S.a,{children:Object(O.jsxs)(x.a,{className:"justify-content-md-center",children:[Object(O.jsx)(g.a,{children:Object(O.jsx)("p",{children:" Me"})}),Object(O.jsx)(g.a,{md:"auto",children:Object(O.jsx)("p",{children:t.content})}),Object(O.jsx)(g.a,{children:e.addFile(t.file)})]})}),Object(O.jsx)("span",{className:"time-right",children:t.time})]},a)}))}),Object(O.jsxs)("form",{className:"form-message",children:[Object(O.jsx)("input",{type:"file",id:"file",name:"file",onChange:this.handleFileChange}),Object(O.jsx)("input",{className:"message-input",type:"text",name:"name",placeholder:"Type your message",value:this.state.content,onChange:this.handleMessageChange}),Object(O.jsx)("input",{type:"submit",value:"Send",onClick:this.sendMessage})]})]})}}]),a}(c.a.Component),A=null,B=function(e){Object(L.a)(n,e);var t=Object(P.a)(n);function n(e){var c;return Object(F.a)(this,n),(c=t.call(this,e)).connect=function(){var e=localStorage.getItem("authorization"),t=a(121),n=a(128);n=new n("https://chat.localhost/ws/?access_token="+e),(A=t.over(n)).connect({},c.onConnected,c.onError)},c.onConnected=function(){c.state.rooms.forEach((function(e){var t=e.id;p.a.get("https://chat.localhost/history/"+t).then((function(e){c.setState((function(a){return{messages:Object(R.a)(Object(R.a)({},a.messages),{},Object(I.a)({},t,e.data))}})),A.subscribe("/topic/"+t,c.onMessageReceived)}))}))},c.onMessageReceived=function(e){var t=JSON.parse(e.body);if(t.username!==c.state.username&&t.roomId!==c.state.selectedRoom){var a=c.state.notifications;a.push(t.roomId),c.setState({notifications:a})}var n=t.roomId;if(null!=t.file)N(),p.a.get("https://chat.localhost/download/"+t.file.id).then((function(e){var a=c.state.messages[n];a.push({username:t.username,content:t.content,time:t.time,file:{name:t.file.name,content:e.data,contentType:t.file.contentType}}),c.setState((function(e){return{messages:Object(R.a)(Object(R.a)({},e.messages),{},Object(I.a)({},n,a))}}))}));else{var s=c.state.messages[n];s.push({username:t.username,content:t.content,time:t.time,file:null}),c.setState((function(e){return{messages:Object(R.a)(Object(R.a)({},e.messages),{},Object(I.a)({},n,s))}}))}},c.onError=function(e){c.setState({error:"Could not connect you to the Chat Room Server. Please refresh this page and try again!"})},c.selectRoom=function(e){c.setState({selectedRoom:e.id}),c.setState({selectedRoomName:e.name});var t=c.state.notifications,a=t.indexOf(e.id);a>-1&&(t.splice(a,1),c.setState({notifications:t}))},c.getRooms=function(){if(null!=c.state.rooms)return Object(O.jsx)("ul",{children:c.state.rooms.map((function(e){return Object(O.jsx)("li",{onClick:function(){c.selectRoom(e)},children:Object(O.jsxs)("p",{className:"room-name",children:[e.name," ",c.state.notifications.includes(e.id)&&Object(O.jsx)(G.a,{})," "]})},e.id)}))})},c.showSelectedRoom=function(){return null===c.state.selectedRoom?Object(O.jsx)("p",{children:"Select a chat room."}):Object(O.jsx)(q,{id:c.state.selectedRoom,username:c.state.username,selectedRoomName:c.state.selectedRoomName,messages:c.state.messages[c.state.selectedRoom],parentCallback:c.sendMessage},c.state.selectedRoom)},c.logout=function(){localStorage.clear(),c.props.navigate("/chat/")},c.sendMessage=function(e,t,a){var n=new FormData;n.append("file",a);var c={content:e,roomId:t};n.append("file",a),n.append("message",new Blob([JSON.stringify(c)],{type:"application/json"})),N(),p.a.post("https://chat.localhost/chat",n)},c.state={username:"",rooms:[],content:"",messages:{},error:"",notifications:[],selectedRoom:null,selectedRoomName:null},c}return Object(T.a)(n,[{key:"componentDidMount",value:function(){var e=this;p.a.get("https://chat.localhost/all_rooms").then((function(t){e.setState({rooms:t.data}),e.connect()})),p.a.get("https://chat.localhost/info").then((function(t){e.setState({username:t.data})}))}},{key:"componentWillUnmount",value:function(){this.state.rooms.forEach((function(e){var t=e.id;A.unsubscribe("/topic/"+t)}))}},{key:"render",value:function(){var e=this;return Object(O.jsxs)("div",{className:"chat-page",children:[Object(O.jsx)(h.a,{onClick:function(){e.logout()},children:"Logout"}),Object(O.jsx)("div",{className:"chat-box-container",children:Object(O.jsx)(S.a,{children:Object(O.jsxs)(x.a,{className:"mb-3 row-container",children:[Object(O.jsxs)(g.a,{className:"list-scroll list-with-rooms",children:[" ",Object(O.jsx)("h4",{children:"Chat Rooms"})," ",this.getRooms()]}),Object(O.jsx)(g.a,{className:"list-scroll",children:this.showSelectedRoom()})]})})})]})}}]),n}(c.a.Component);var D=function(e){var t=Object(j.g)();return Object(O.jsx)(B,Object(R.a)(Object(R.a)({},e),{},{navigate:t}))},U=a(87);function J(e){var t=e.children,a=e.redirectTo;return!0===localStorage.getItem("isAuthenticated")?Object(O.jsx)(j.a,{to:a}):t}function V(e){var t=e.children,a=e.redirectTo,c=Object(n.useState)(null),s=Object(u.a)(c,2),r=s[0],o=s[1],d=Object(n.useState)(!0),h=Object(u.a)(d,2),b=h[0],m=h[1];return Object(n.useEffect)((function(){function e(){return(e=Object(l.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,m(!0),e.next=4,W();case 4:t=e.sent,localStorage.setItem("isAuthenticated",t),o(t),m(!1),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),m(!1),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),b?Object(O.jsx)(U.a,{animation:"border"}):r?t:Object(O.jsx)(j.a,{to:a})}function W(){return Z.apply(this,arguments)}function Z(){return(Z=Object(l.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=null,N(),e.next=4,p.a.get("https://chat.localhost/auth/authorize").then((function(e){t=!0})).catch((function(e){t=!1}));case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var _=function(){return Object(O.jsx)("div",{className:"App",children:Object(O.jsx)("header",{className:"App-header",children:Object(O.jsx)(d.a,{children:Object(O.jsxs)(j.d,{children:[Object(O.jsx)(j.b,{exact:!0,path:"/chat/login",element:Object(O.jsxs)(J,{redirectTo:"/dashboard",children:[" ",Object(O.jsx)(f,{})," "]})}),Object(O.jsx)(j.b,{exact:!0,path:"/chat/signup",element:Object(O.jsxs)(J,{redirectTo:"/dashboard",children:[" ",Object(O.jsx)(w,{})," "]})}),Object(O.jsx)(j.b,{exact:!0,path:"/chat/dashboard",element:Object(O.jsxs)(V,{redirectTo:"/login",children:[" ",Object(O.jsx)(D,{})," "]})}),Object(O.jsx)(j.b,{exact:!0,path:"/chat/",element:Object(O.jsx)(y,{})}),Object(O.jsx)(j.b,{path:"*",element:Object(O.jsx)(j.a,{to:"/chat/"})})]})})})})},Y=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,166)).then((function(t){var a=t.getCLS,n=t.getFID,c=t.getFCP,s=t.getLCP,r=t.getTTFB;a(e),n(e),c(e),s(e),r(e)}))};r.a.render(Object(O.jsx)(c.a.StrictMode,{children:Object(O.jsx)(_,{})}),document.getElementById("root")),Y(),window.React1=a(0)},65:function(e,t,a){},94:function(e,t,a){},96:function(e,t,a){}},[[159,1,2]]]);
//# sourceMappingURL=main.93668389.chunk.js.map